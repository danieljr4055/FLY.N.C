const baseConocimiento = {
  "general": {
    "¿Qué es FLYNC?": "FLY.N.C es una empresa que ofrece experiencias aéreas únicas en paratrike, con sede en Cartago, Valle del Cauca, y vuelos realizados en una pista privada ubicada en Obando.",
    "¿Qué significa FLY.N.C?": "El nombre FLY.N.C nació de la idea de 'Fly' (volar) y 'N.C', que proviene de 'in Cartago', nuestra ciudad. Representa nuestra pasión por volar y el orgullo de hacerlo en el cielo de Cartago, Valle.",
    "¿Qué servicios ofrecen?": "Ofrecemos vuelos recreativos en paratrike, grabación profesional, sesiones fotográficas, experiencias románticas y paquetes para grupos o eventos especiales.",
    "¿Qué es un paratrike?": "El paratrike es un parapente motorizado con tres ruedas que permite despegar desde tierra sin correr. Es estable, seguro y perfecto para principiantes.",
    "¿Dónde están ubicados?": "Nuestra sede principal está en Cartago, Valle del Cauca, y los vuelos se realizan en una pista privada del municipio de Obando.",
    "¿Qué días están disponibles?": "Volamos todos los días, siempre que el clima sea favorable. Los mejores horarios son en la mañana o al atardecer.",
    "¿Cuánto dura un vuelo?": "El tiempo promedio es entre 15 y 30 minutos, dependiendo del paquete y las condiciones del clima.",
    "¿Tienen redes sociales?": "Sí, estamos en Instagram, Facebook y TikTok como @flync.co, donde compartimos videos, promociones y experiencias de vuelo.",
    "¿Qué se siente volar?": "Es una mezcla entre libertad, calma y adrenalina. Sentir el viento y ver el paisaje desde el cielo es una experiencia mágica.",
    "¿Tienen servicio de transporte?": "Podemos coordinar transporte desde Cartago o municipios cercanos con costo adicional."
  },

  "reservas": {
    "¿Cómo puedo reservar un vuelo?": "Puedes reservar desde nuestra página web, por WhatsApp o redes sociales. Solo dinos la fecha y hora que prefieres.",
    "¿Cuánto cuesta el vuelo?": "Los precios van desde 180.000 hasta 250.000 pesos por persona, según el tipo de vuelo y si incluye fotos o video.",
    "¿Qué métodos de pago aceptan?": "Aceptamos Nequi, Daviplata, transferencia bancaria y efectivo. Pronto habilitaremos pagos con tarjeta.",
    "¿Qué pasa si el clima está mal?": "Si hay mal tiempo, se reprograma sin costo adicional. La seguridad está primero.",
    "¿Puedo regalar un vuelo a alguien?": "¡Sí! Tenemos bonos digitales personalizados, perfectos para cumpleaños o aniversarios.",
    "¿Cuánto tiempo antes debo llegar?": "Por favor llega 20 minutos antes para la charla de seguridad y la preparación.",
    "¿Hay límite de peso o edad?": "Sí, el peso máximo es 100 kg y la edad mínima es 10 años (con permiso de acudiente)."
  },

"seguridad": {
  "¿Es seguro volar en paratrike?": "Sí, completamente. En FLY.N.C operamos bajo normas europeas de seguridad para vuelo ultraliviano (EN y EASA). Todos nuestros procedimientos están diseñados para garantizar la máxima protección del pasajero en cada vuelo.",
  
  "¿Qué medidas de seguridad usan?": "Cada pasajero recibe casco certificado, arnés de vuelo ajustado, instrucciones previas y acompañamiento constante del piloto. Además, se realiza una revisión técnica antes y después de cada operación.",
  
  "¿Qué pasa si me da miedo?": "Nuestro piloto controla el ritmo y la altura para que te sientas tranquilo. Si lo prefieres, puede mantener una altura baja o finalizar el vuelo de forma anticipada sin problema.",
  
  "¿Han tenido accidentes?": "No. Gracias a nuestros protocolos estrictos y mantenimiento continuo, FLY.N.C mantiene un historial de vuelo 100% seguro.",
  
  "¿Puedo volar si tengo vértigo?": "Sí. La mayoría de nuestros pasajeros con vértigo disfrutan el vuelo, ya que es estable, sin sensación de caída y con vista panorámica constante.",
  
  "¿Qué estándares de seguridad siguen?": "Cumplimos con las recomendaciones de la Federación Colombiana de Deportes Aéreos (FEDEAÉREOS) y aplicamos normas europeas EN-926 y EASA para equipos y operación. Ningún vuelo despega sin revisión previa ni con condiciones climáticas inestables.",
  
  "¿Cómo es el mantenimiento de los paratrikes?": "Realizamos mantenimiento preventivo cada 20 horas de vuelo o cada mes, lo que ocurra primero. Cada revisión incluye motor, hélice, chasis, tornillería, líneas y velamen, siguiendo protocolos internacionales de aeronáutica deportiva.",
  
  "¿Cada cuánto cambian las partes o componentes?": "Las líneas del parapente se reemplazan cada 200 horas de vuelo, los motores se revisan a fondo cada 6 meses y las hélices se sustituyen en cuanto presentan el mínimo desgaste o vibración anormal.",
  
  "¿Qué tipo de gasolina usan los motores?": "Usamos gasolina extra mezclada con aceite sintético de alto rendimiento, en proporción exacta según las especificaciones del fabricante, para mantener el motor en óptimas condiciones y reducir emisiones.",
  
  "¿Quién realiza el mantenimiento?": "Contamos con técnico certificado en motores Rotax y Top80, especializado en aeronaves ultralivianas. Todas las inspecciones se registran en una bitácora firmada y verificada por el área técnica.",
  
  "¿Verifican los equipos antes de cada vuelo?": "Sí, sin excepción. Antes del despegue, el piloto revisa combustible, frenos, líneas, hélice, arnés, cinturones y sistema de comunicación. Ningún vuelo despega sin aprobar la lista de chequeo.",
  
  "¿Qué pasa si detectan una falla?": "El equipo queda fuera de servicio de inmediato y se somete a inspección completa. No se realizan vuelos hasta que esté 100% certificado por el técnico responsable.",
  
  "¿Tienen póliza o cobertura de seguro?": "Sí. Todos nuestros vuelos incluyen cobertura de seguro para pasajeros y responsabilidad civil, garantizando protección médica y material en caso de imprevistos.",
  
  "¿Qué pasa si hay mucho viento o el clima cambia?": "El vuelo se cancela o reprograma sin costo. La seguridad siempre está por encima de cualquier horario o compromiso.",
  
  "¿Cómo entrenan a los pilotos?": "Nuestros pilotos están certificados, tienen entrenamiento continuo en maniobras de emergencia, meteorología y primeros auxilios. Cuentan con amplia experiencia en vuelos tándem y operación profesional de paratrikes."
},

"contacto": {
  "¿Cuál es el número de teléfono o WhatsApp?": "Puedes comunicarte con nosotros directamente al 📱 312 729 6703. Atendemos mensajes, llamadas y WhatsApp todos los días de 8:00 a.m. a 8:00 p.m. Para obtener más información o agendar tu vuelo, también puedes dirigirte al apartado de 'Contacto' en nuestra página web y rellenar el formulario.",
  
  "¿Tienen correo electrónico?": "Sí, puedes escribirnos a ✉️ santysanoro@gmail.com. Nuestro equipo te responderá lo antes posible con toda la información que necesites. También puedes usar el formulario en el apartado 'Contacto' de la web para una respuesta más rápida.",
  
  "¿Cómo puedo comunicarme con ustedes?": "Tenemos varios canales: por WhatsApp al 312 729 6703, correo a santysanoro@gmail.com o a través del formulario del apartado 'Contacto' en la web. Desde allí podrás recibir atención personalizada y detalles según tu tipo de vuelo.",
  
  "¿Dónde puedo dejar mis datos o hacer una consulta?": "En el apartado 'Contacto' de nuestra página web encontrarás un formulario donde puedes dejar tus datos, escribir tu mensaje o consulta, y recibirás toda la información directamente en tu correo.",
  
  "¿Atienden por redes sociales?": "Sí, también puedes escribirnos en Instagram, Facebook o TikTok como @flync.co. Sin embargo, para cotizaciones o reservas formales te recomendamos usar el formulario del apartado 'Contacto' o escribirnos por WhatsApp."
},

  "equipos_y_tecnica": {
    "¿Qué motor usan los paratrikes?": "Usamos motores Rotax y Top80 de alto rendimiento, reconocidos por su fiabilidad en vuelos ultralivianos.",
    "¿De qué material son las hélices?": "Las hélices son de fibra de carbono, ligeras y resistentes para reducir vibración y mejorar el rendimiento.",
    "¿Qué tipo de parapente utilizan?": "Usamos velas tipo reflex, diseñadas para vuelo motorizado, con gran estabilidad y seguridad en turbulencias leves.",
    "¿Cuál es la velocidad promedio de vuelo?": "Entre 35 y 60 km/h dependiendo del viento y peso del pasajero.",
    "¿A qué altura se vuela normalmente?": "Entre 200 y 500 metros sobre el nivel del suelo, suficiente para disfrutar del paisaje sin perder contacto visual con tierra.",
    "¿Cuánta gasolina consume un vuelo?": "Aproximadamente entre 2 y 3 litros por vuelo de 20 minutos.",
    "¿Cuánto pesa un paratrike?": "Entre 60 y 80 kg dependiendo del modelo, sin contar el piloto ni el pasajero.",
    "¿Qué pasa si se apaga el motor en el aire?": "El parapente planea suavemente y el piloto puede aterrizar sin problema, ya que el motor solo sirve para mantener altura, no para sostener el vuelo."
  },

  "técnico_profesional": {
    "¿Tienen bitácora de mantenimiento?": "Sí, registramos cada vuelo, mantenimiento, revisión y cambio de piezas en una bitácora física y digital.",
    "¿Cuánto dura una inspección completa?": "Entre 1 y 2 horas dependiendo del tipo de revisión. No se vuela ningún equipo sin pasar este control.",
    "¿Cómo garantizan la trazabilidad del mantenimiento?": "Cada intervención técnica se firma y fecha, asegurando control de horas de vuelo y reemplazo de partes.",
    "¿Usan checklist antes del vuelo?": "Sí, los pilotos siguen una lista de verificación que incluye motor, hélice, líneas, velamen, viento, arnés y comunicación con tierra.",
    "¿Cómo controlan el peso máximo permitido?": "Pesamos al pasajero antes del vuelo y ajustamos el trike y el parapente según el rango seguro establecido por el fabricante."
  },

  "experiencia": {
    "¿Qué debo llevar?": "Ropa cómoda, zapatos cerrados, gafas de sol y bloqueador solar. Nosotros te damos el casco y arnés.",
    "¿Puedo grabar el vuelo?": "Sí. Tenemos cámaras GoPro para fotos y videos en alta calidad.",
    "¿Puedo volar con mi pareja?": "Sí ❤️ ofrecemos vuelos consecutivos o paquetes románticos con flores y video incluido.",
    "¿Puedo ir con amigos o familia?": "Claro. Pueden acompañarte y ver los vuelos desde la zona de espera.",
    "¿Dónde está la pista?": "En una finca privada del municipio de Obando, a 15 minutos de Cartago. Te enviamos la ubicación exacta al reservar.",
    "¿Hacen vuelos al amanecer o atardecer?": "Sí, esos son los horarios más hermosos por la luz y la calma del viento."
  },

  "ubicacion": {
    "¿Dónde están ubicados exactamente?": "Estamos en Cartago, Valle del Cauca, y los vuelos se realizan en una pista privada en Obando.",
    "¿Cómo llego a la pista?": "Al confirmar tu reserva te enviamos la ubicación exacta por WhatsApp o Google Maps.",
    "¿Tienen sede física?": "Sí, en Cartago. Desde allí coordinamos las reservas y transporte a la pista.",
    "¿Cuánto se demora desde Cartago?": "Aproximadamente 15 minutos en carro.",
    "¿Se puede llegar en moto o carro particular?": "Sí, tenemos parqueadero disponible cerca de la pista.",
    "¿Qué pasa si no conozco la zona?": "No te preocupes, te enviamos un mapa y guía de cómo llegar fácilmente.",
    "¿Dónde es el punto de encuentro?": "Normalmente en la sede de Cartago o directamente en la pista, según la reserva."
  },

  "servicios_extra": {
    "¿Ofrecen fotos o videos?": "Sí, puedes agregar el paquete GoPro con edición profesional y entrega digital.",
    "¿Hacen eventos especiales?": "Sí, realizamos experiencias para cumpleaños, pedidas de mano y grabaciones publicitarias.",
    "¿Ofrecen vuelos en otras ciudades?": "Por ahora solo en el norte del Valle, pero estamos planeando expandirnos al Eje Cafetero.",
    "¿Tienen paquetes para empresas?": "Sí, creamos experiencias para equipos de trabajo o grupos de aventura."
  },

  "empresa": {
    "¿Desde cuándo existe FLYNC?": "Desde 2023. Nacimos como un proyecto familiar enfocado en turismo y aventura aérea.",
    "¿Quiénes son los fundadores?": "Un equipo joven del norte del Valle apasionado por el vuelo y el turismo regional.",
    "¿Qué diferencia a FLYNC de otros lugares?": "Nuestra atención personalizada, seguridad y compromiso por crear recuerdos inolvidables.",
    "¿Por qué elegir FLYNC?": "Porque no solo te ofrecemos un vuelo, sino una experiencia de libertad y conexión real con el cielo."
  },

  "promociones": {
    "¿Tienen promociones?": "Sí, en fechas especiales lanzamos descuentos o combos para parejas y grupos.",
    "¿Cómo sé si hay descuentos activos?": "Puedes revisar nuestras redes sociales o escribirnos por WhatsApp.",
    "¿Hay descuento por grupos?": "Sí, a partir de 3 personas ofrecemos tarifas especiales.",
    "¿Hacen rifas o sorteos?": "Sí 🎉 ocasionalmente realizamos sorteos en Instagram, participa siguiéndonos como @flync.co."
  },

  "preguntas_frecuentes": {
    "¿Qué pasa si llueve?": "Se reprograma el vuelo sin costo. La seguridad es prioridad.",
    "¿Puedo llevar mi celular?": "Sí, pero recomendamos asegurar bien tus pertenencias para evitar caídas.",
    "¿Hay baños o zona de espera?": "Sí, la pista cuenta con zona de descanso y baño disponible.",
    "¿Puedo volar si tengo una condición médica?": "Depende del caso. Si es algo leve, no hay problema, pero recomendamos avisarlo antes del vuelo.",
    "¿Puedo llevar mascotas?": "No durante el vuelo, pero pueden quedarse acompañadas en tierra.",
    "¿Qué pasa si llego tarde?": "El vuelo puede reprogramarse según disponibilidad, pero te recomendamos puntualidad.",
    "¿Puedo cambiar mi reserva?": "Sí, puedes hacerlo con mínimo 12 horas de anticipación."
  }
};


// 🗣️ Respuestas rápidas
const respuestasSaludo = [
  "¡Hola! 😊 ¿Cómo estás?",
  "¡Hola! 👋 Bienvenido a FLY.N.C.",
  "¡Hola! 🪂 ¿Listo para una experiencia en el cielo?"
];

const respuestasDespedida = [
  "¡Hasta pronto! 👋 Gracias por interesarte en FLY.N.C. ¡Te esperamos para volar!",
  "¡Nos vemos en el cielo! 🪂",
  "¡Adiós! 🌤️ Que tengas un gran día lleno de aventura."
];

// 🧹 Procesamiento de texto
function limpiarTexto(texto) {
  return texto
    .toLowerCase()
    .replace(/[^\w\s¿?áéíóúñ]/g, " ")
    .replace(/\s+/g, " ")
    .trim();
}

// 🎯 Detectar saludo o despedida
function detectarSaludo(pregunta) {
  const saludos = ["hola", "buenos días", "buenas tardes", "buenas noches", "saludos", "qué tal", "hey"];
  return saludos.some(s => limpiarTexto(pregunta).includes(s));
}

function detectarDespedida(pregunta) {
  const despedidas = ["adiós", "hasta luego", "nos vemos", "chau", "bye", "salir", "terminar"];
  return despedidas.some(d => limpiarTexto(pregunta).includes(d));
}

// 🔍 Calcular similitud básica (por palabras coincidentes)
function calcularSimilitud(p1, p2) {
  const palabras1 = new Set(limpiarTexto(p1).split(" "));
  const palabras2 = new Set(limpiarTexto(p2).split(" "));
  const interseccion = [...palabras1].filter(p => palabras2.has(p)).length;
  const union = Math.max(palabras1.size, palabras2.size);
  return interseccion / union;
}

// 💬 Buscar mejor respuesta
function encontrarMejorRespuesta(preguntaUsuario) {
  if (detectarSaludo(preguntaUsuario)) {
    return respuestasSaludo[Math.floor(Math.random() * respuestasSaludo.length)];
  }
  if (detectarDespedida(preguntaUsuario)) {
    return respuestasDespedida[Math.floor(Math.random() * respuestasDespedida.length)];
  }

  let mejorRespuesta = "";
  let mejorPuntuacion = 0;

  for (const categoria in baseConocimiento) {
    const preguntas = baseConocimiento[categoria];
    for (const preguntaBase in preguntas) {
      const puntuacion = calcularSimilitud(preguntaUsuario, preguntaBase);
      if (puntuacion > mejorPuntuacion) {
        mejorPuntuacion = puntuacion;
        mejorRespuesta = preguntas[preguntaBase];
      }
    }
  }

  if (mejorPuntuacion > 0.2) {
    return "🪂 " + mejorRespuesta;
  } else {
    const alternativas = [
      "🤔 No estoy seguro, ¿podrías reformular tu pregunta sobre FLY.N.C?",
      "🔍 Puedo ayudarte con reservas, precios, ubicación o seguridad del vuelo.",
      "❓ Hmm, no tengo esa información por ahora."
    ];
    return alternativas[Math.floor(Math.random() * alternativas.length)];
  }
}

// 🧩 Interfaz con HTML
const chatbotBody = document.getElementById("chatbot-body");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const closeChat = document.getElementById("close-chat");
const chatbotContainer = document.getElementById("chatbot");

// Mostrar y ocultar chatbot
const chatbotBtn = document.querySelector(".chatbot-btn");
if (chatbotBtn) {
  chatbotBtn.addEventListener("click", () => {
    chatbotContainer.style.display = "flex";
  });
}

if (closeChat) {
  closeChat.addEventListener("click", () => {
    chatbotContainer.style.display = "none";
  });
}

// Enviar mensaje
function agregarMensaje(mensaje, tipo) {
  const div = document.createElement("div");
  div.classList.add(tipo === "bot" ? "bot-message" : "user-message");
  div.textContent = mensaje;
  chatbotBody.appendChild(div);
  chatbotBody.scrollTop = chatbotBody.scrollHeight;
}

function enviarMensaje() {
  const texto = userInput.value.trim();
  if (!texto) return;
  agregarMensaje(texto, "user");
  userInput.value = "";

  setTimeout(() => {
    const respuesta = encontrarMejorRespuesta(texto);
    agregarMensaje(respuesta, "bot");
  }, 400);
}

sendBtn.addEventListener("click", enviarMensaje);
userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") enviarMensaje();
});
