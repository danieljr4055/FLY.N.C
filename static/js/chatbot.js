const baseConocimiento = {
  "general": {
    "Â¿QuÃ© es FLYNC?": "FLY.N.C es una empresa que ofrece experiencias aÃ©reas Ãºnicas en paratrike, con sede en Cartago, Valle del Cauca, y vuelos realizados en una pista privada ubicada en Obando.",
    "Â¿QuÃ© significa FLY.N.C?": "El nombre FLY.N.C naciÃ³ de la idea de 'Fly' (volar) y 'N.C', que proviene de 'in Cartago', nuestra ciudad. Representa nuestra pasiÃ³n por volar y el orgullo de hacerlo en el cielo de Cartago, Valle.",
    "Â¿QuÃ© servicios ofrecen?": "Ofrecemos vuelos recreativos en paratrike, grabaciÃ³n profesional, sesiones fotogrÃ¡ficas, experiencias romÃ¡nticas y paquetes para grupos o eventos especiales.",
    "Â¿QuÃ© es un paratrike?": "El paratrike es un parapente motorizado con tres ruedas que permite despegar desde tierra sin correr. Es estable, seguro y perfecto para principiantes.",
    "Â¿DÃ³nde estÃ¡n ubicados?": "Nuestra sede principal estÃ¡ en Cartago, Valle del Cauca, y los vuelos se realizan en una pista privada del municipio de Obando.",
    "Â¿QuÃ© dÃ­as estÃ¡n disponibles?": "Volamos todos los dÃ­as, siempre que el clima sea favorable. Los mejores horarios son en la maÃ±ana o al atardecer.",
    "Â¿CuÃ¡nto dura un vuelo?": "El tiempo promedio es entre 15 y 30 minutos, dependiendo del paquete y las condiciones del clima.",
    "Â¿Tienen redes sociales?": "SÃ­, estamos en Instagram, Facebook y TikTok como @flync.co, donde compartimos videos, promociones y experiencias de vuelo.",
    "Â¿QuÃ© se siente volar?": "Es una mezcla entre libertad, calma y adrenalina. Sentir el viento y ver el paisaje desde el cielo es una experiencia mÃ¡gica.",
    "Â¿Tienen servicio de transporte?": "Podemos coordinar transporte desde Cartago o municipios cercanos con costo adicional."
  },

  "reservas": {
    "Â¿CÃ³mo puedo reservar un vuelo?": "Puedes reservar desde nuestra pÃ¡gina web, por WhatsApp o redes sociales. Solo dinos la fecha y hora que prefieres.",
    "Â¿CuÃ¡nto cuesta el vuelo?": "Los precios van desde 180.000 hasta 250.000 pesos por persona, segÃºn el tipo de vuelo y si incluye fotos o video.",
    "Â¿QuÃ© mÃ©todos de pago aceptan?": "Aceptamos Nequi, Daviplata, transferencia bancaria y efectivo. Pronto habilitaremos pagos con tarjeta.",
    "Â¿QuÃ© pasa si el clima estÃ¡ mal?": "Si hay mal tiempo, se reprograma sin costo adicional. La seguridad estÃ¡ primero.",
    "Â¿Puedo regalar un vuelo a alguien?": "Â¡SÃ­! Tenemos bonos digitales personalizados, perfectos para cumpleaÃ±os o aniversarios.",
    "Â¿CuÃ¡nto tiempo antes debo llegar?": "Por favor llega 20 minutos antes para la charla de seguridad y la preparaciÃ³n.",
    "Â¿Hay lÃ­mite de peso o edad?": "SÃ­, el peso mÃ¡ximo es 100 kg y la edad mÃ­nima es 10 aÃ±os (con permiso de acudiente)."
  },

"seguridad": {
  "Â¿Es seguro volar en paratrike?": "SÃ­, completamente. En FLY.N.C operamos bajo normas europeas de seguridad para vuelo ultraliviano (EN y EASA). Todos nuestros procedimientos estÃ¡n diseÃ±ados para garantizar la mÃ¡xima protecciÃ³n del pasajero en cada vuelo.",
  
  "Â¿QuÃ© medidas de seguridad usan?": "Cada pasajero recibe casco certificado, arnÃ©s de vuelo ajustado, instrucciones previas y acompaÃ±amiento constante del piloto. AdemÃ¡s, se realiza una revisiÃ³n tÃ©cnica antes y despuÃ©s de cada operaciÃ³n.",
  
  "Â¿QuÃ© pasa si me da miedo?": "Nuestro piloto controla el ritmo y la altura para que te sientas tranquilo. Si lo prefieres, puede mantener una altura baja o finalizar el vuelo de forma anticipada sin problema.",
  
  "Â¿Han tenido accidentes?": "No. Gracias a nuestros protocolos estrictos y mantenimiento continuo, FLY.N.C mantiene un historial de vuelo 100% seguro.",
  
  "Â¿Puedo volar si tengo vÃ©rtigo?": "SÃ­. La mayorÃ­a de nuestros pasajeros con vÃ©rtigo disfrutan el vuelo, ya que es estable, sin sensaciÃ³n de caÃ­da y con vista panorÃ¡mica constante.",
  
  "Â¿QuÃ© estÃ¡ndares de seguridad siguen?": "Cumplimos con las recomendaciones de la FederaciÃ³n Colombiana de Deportes AÃ©reos (FEDEAÃ‰REOS) y aplicamos normas europeas EN-926 y EASA para equipos y operaciÃ³n. NingÃºn vuelo despega sin revisiÃ³n previa ni con condiciones climÃ¡ticas inestables.",
  
  "Â¿CÃ³mo es el mantenimiento de los paratrikes?": "Realizamos mantenimiento preventivo cada 20 horas de vuelo o cada mes, lo que ocurra primero. Cada revisiÃ³n incluye motor, hÃ©lice, chasis, tornillerÃ­a, lÃ­neas y velamen, siguiendo protocolos internacionales de aeronÃ¡utica deportiva.",
  
  "Â¿Cada cuÃ¡nto cambian las partes o componentes?": "Las lÃ­neas del parapente se reemplazan cada 200 horas de vuelo, los motores se revisan a fondo cada 6 meses y las hÃ©lices se sustituyen en cuanto presentan el mÃ­nimo desgaste o vibraciÃ³n anormal.",
  
  "Â¿QuÃ© tipo de gasolina usan los motores?": "Usamos gasolina extra mezclada con aceite sintÃ©tico de alto rendimiento, en proporciÃ³n exacta segÃºn las especificaciones del fabricante, para mantener el motor en Ã³ptimas condiciones y reducir emisiones.",
  
  "Â¿QuiÃ©n realiza el mantenimiento?": "Contamos con tÃ©cnico certificado en motores Rotax y Top80, especializado en aeronaves ultralivianas. Todas las inspecciones se registran en una bitÃ¡cora firmada y verificada por el Ã¡rea tÃ©cnica.",
  
  "Â¿Verifican los equipos antes de cada vuelo?": "SÃ­, sin excepciÃ³n. Antes del despegue, el piloto revisa combustible, frenos, lÃ­neas, hÃ©lice, arnÃ©s, cinturones y sistema de comunicaciÃ³n. NingÃºn vuelo despega sin aprobar la lista de chequeo.",
  
  "Â¿QuÃ© pasa si detectan una falla?": "El equipo queda fuera de servicio de inmediato y se somete a inspecciÃ³n completa. No se realizan vuelos hasta que estÃ© 100% certificado por el tÃ©cnico responsable.",
  
  "Â¿Tienen pÃ³liza o cobertura de seguro?": "SÃ­. Todos nuestros vuelos incluyen cobertura de seguro para pasajeros y responsabilidad civil, garantizando protecciÃ³n mÃ©dica y material en caso de imprevistos.",
  
  "Â¿QuÃ© pasa si hay mucho viento o el clima cambia?": "El vuelo se cancela o reprograma sin costo. La seguridad siempre estÃ¡ por encima de cualquier horario o compromiso.",
  
  "Â¿CÃ³mo entrenan a los pilotos?": "Nuestros pilotos estÃ¡n certificados, tienen entrenamiento continuo en maniobras de emergencia, meteorologÃ­a y primeros auxilios. Cuentan con amplia experiencia en vuelos tÃ¡ndem y operaciÃ³n profesional de paratrikes."
},

"contacto": {
  "Â¿CuÃ¡l es el nÃºmero de telÃ©fono o WhatsApp?": "Puedes comunicarte con nosotros directamente al ğŸ“± 312 729 6703. Atendemos mensajes, llamadas y WhatsApp todos los dÃ­as de 8:00 a.m. a 8:00 p.m. Para obtener mÃ¡s informaciÃ³n o agendar tu vuelo, tambiÃ©n puedes dirigirte al apartado de 'Contacto' en nuestra pÃ¡gina web y rellenar el formulario.",
  
  "Â¿Tienen correo electrÃ³nico?": "SÃ­, puedes escribirnos a âœ‰ï¸ santysanoro@gmail.com. Nuestro equipo te responderÃ¡ lo antes posible con toda la informaciÃ³n que necesites. TambiÃ©n puedes usar el formulario en el apartado 'Contacto' de la web para una respuesta mÃ¡s rÃ¡pida.",
  
  "Â¿CÃ³mo puedo comunicarme con ustedes?": "Tenemos varios canales: por WhatsApp al 312 729 6703, correo a santysanoro@gmail.com o a travÃ©s del formulario del apartado 'Contacto' en la web. Desde allÃ­ podrÃ¡s recibir atenciÃ³n personalizada y detalles segÃºn tu tipo de vuelo.",
  
  "Â¿DÃ³nde puedo dejar mis datos o hacer una consulta?": "En el apartado 'Contacto' de nuestra pÃ¡gina web encontrarÃ¡s un formulario donde puedes dejar tus datos, escribir tu mensaje o consulta, y recibirÃ¡s toda la informaciÃ³n directamente en tu correo.",
  
  "Â¿Atienden por redes sociales?": "SÃ­, tambiÃ©n puedes escribirnos en Instagram, Facebook o TikTok como @flync.co. Sin embargo, para cotizaciones o reservas formales te recomendamos usar el formulario del apartado 'Contacto' o escribirnos por WhatsApp."
},

  "equipos_y_tecnica": {
    "Â¿QuÃ© motor usan los paratrikes?": "Usamos motores Rotax y Top80 de alto rendimiento, reconocidos por su fiabilidad en vuelos ultralivianos.",
    "Â¿De quÃ© material son las hÃ©lices?": "Las hÃ©lices son de fibra de carbono, ligeras y resistentes para reducir vibraciÃ³n y mejorar el rendimiento.",
    "Â¿QuÃ© tipo de parapente utilizan?": "Usamos velas tipo reflex, diseÃ±adas para vuelo motorizado, con gran estabilidad y seguridad en turbulencias leves.",
    "Â¿CuÃ¡l es la velocidad promedio de vuelo?": "Entre 35 y 60 km/h dependiendo del viento y peso del pasajero.",
    "Â¿A quÃ© altura se vuela normalmente?": "Entre 200 y 500 metros sobre el nivel del suelo, suficiente para disfrutar del paisaje sin perder contacto visual con tierra.",
    "Â¿CuÃ¡nta gasolina consume un vuelo?": "Aproximadamente entre 2 y 3 litros por vuelo de 20 minutos.",
    "Â¿CuÃ¡nto pesa un paratrike?": "Entre 60 y 80 kg dependiendo del modelo, sin contar el piloto ni el pasajero.",
    "Â¿QuÃ© pasa si se apaga el motor en el aire?": "El parapente planea suavemente y el piloto puede aterrizar sin problema, ya que el motor solo sirve para mantener altura, no para sostener el vuelo."
  },

  "tÃ©cnico_profesional": {
    "Â¿Tienen bitÃ¡cora de mantenimiento?": "SÃ­, registramos cada vuelo, mantenimiento, revisiÃ³n y cambio de piezas en una bitÃ¡cora fÃ­sica y digital.",
    "Â¿CuÃ¡nto dura una inspecciÃ³n completa?": "Entre 1 y 2 horas dependiendo del tipo de revisiÃ³n. No se vuela ningÃºn equipo sin pasar este control.",
    "Â¿CÃ³mo garantizan la trazabilidad del mantenimiento?": "Cada intervenciÃ³n tÃ©cnica se firma y fecha, asegurando control de horas de vuelo y reemplazo de partes.",
    "Â¿Usan checklist antes del vuelo?": "SÃ­, los pilotos siguen una lista de verificaciÃ³n que incluye motor, hÃ©lice, lÃ­neas, velamen, viento, arnÃ©s y comunicaciÃ³n con tierra.",
    "Â¿CÃ³mo controlan el peso mÃ¡ximo permitido?": "Pesamos al pasajero antes del vuelo y ajustamos el trike y el parapente segÃºn el rango seguro establecido por el fabricante."
  },

  "experiencia": {
    "Â¿QuÃ© debo llevar?": "Ropa cÃ³moda, zapatos cerrados, gafas de sol y bloqueador solar. Nosotros te damos el casco y arnÃ©s.",
    "Â¿Puedo grabar el vuelo?": "SÃ­. Tenemos cÃ¡maras GoPro para fotos y videos en alta calidad.",
    "Â¿Puedo volar con mi pareja?": "SÃ­ â¤ï¸ ofrecemos vuelos consecutivos o paquetes romÃ¡nticos con flores y video incluido.",
    "Â¿Puedo ir con amigos o familia?": "Claro. Pueden acompaÃ±arte y ver los vuelos desde la zona de espera.",
    "Â¿DÃ³nde estÃ¡ la pista?": "En una finca privada del municipio de Obando, a 15 minutos de Cartago. Te enviamos la ubicaciÃ³n exacta al reservar.",
    "Â¿Hacen vuelos al amanecer o atardecer?": "SÃ­, esos son los horarios mÃ¡s hermosos por la luz y la calma del viento."
  },

  "ubicacion": {
    "Â¿DÃ³nde estÃ¡n ubicados exactamente?": "Estamos en Cartago, Valle del Cauca, y los vuelos se realizan en una pista privada en Obando.",
    "Â¿CÃ³mo llego a la pista?": "Al confirmar tu reserva te enviamos la ubicaciÃ³n exacta por WhatsApp o Google Maps.",
    "Â¿Tienen sede fÃ­sica?": "SÃ­, en Cartago. Desde allÃ­ coordinamos las reservas y transporte a la pista.",
    "Â¿CuÃ¡nto se demora desde Cartago?": "Aproximadamente 15 minutos en carro.",
    "Â¿Se puede llegar en moto o carro particular?": "SÃ­, tenemos parqueadero disponible cerca de la pista.",
    "Â¿QuÃ© pasa si no conozco la zona?": "No te preocupes, te enviamos un mapa y guÃ­a de cÃ³mo llegar fÃ¡cilmente.",
    "Â¿DÃ³nde es el punto de encuentro?": "Normalmente en la sede de Cartago o directamente en la pista, segÃºn la reserva."
  },

  "servicios_extra": {
    "Â¿Ofrecen fotos o videos?": "SÃ­, puedes agregar el paquete GoPro con ediciÃ³n profesional y entrega digital.",
    "Â¿Hacen eventos especiales?": "SÃ­, realizamos experiencias para cumpleaÃ±os, pedidas de mano y grabaciones publicitarias.",
    "Â¿Ofrecen vuelos en otras ciudades?": "Por ahora solo en el norte del Valle, pero estamos planeando expandirnos al Eje Cafetero.",
    "Â¿Tienen paquetes para empresas?": "SÃ­, creamos experiencias para equipos de trabajo o grupos de aventura."
  },

  "empresa": {
    "Â¿Desde cuÃ¡ndo existe FLYNC?": "Desde 2023. Nacimos como un proyecto familiar enfocado en turismo y aventura aÃ©rea.",
    "Â¿QuiÃ©nes son los fundadores?": "Un equipo joven del norte del Valle apasionado por el vuelo y el turismo regional.",
    "Â¿QuÃ© diferencia a FLYNC de otros lugares?": "Nuestra atenciÃ³n personalizada, seguridad y compromiso por crear recuerdos inolvidables.",
    "Â¿Por quÃ© elegir FLYNC?": "Porque no solo te ofrecemos un vuelo, sino una experiencia de libertad y conexiÃ³n real con el cielo."
  },

  "promociones": {
    "Â¿Tienen promociones?": "SÃ­, en fechas especiales lanzamos descuentos o combos para parejas y grupos.",
    "Â¿CÃ³mo sÃ© si hay descuentos activos?": "Puedes revisar nuestras redes sociales o escribirnos por WhatsApp.",
    "Â¿Hay descuento por grupos?": "SÃ­, a partir de 3 personas ofrecemos tarifas especiales.",
    "Â¿Hacen rifas o sorteos?": "SÃ­ ğŸ‰ ocasionalmente realizamos sorteos en Instagram, participa siguiÃ©ndonos como @flync.co."
  },

  "preguntas_frecuentes": {
    "Â¿QuÃ© pasa si llueve?": "Se reprograma el vuelo sin costo. La seguridad es prioridad.",
    "Â¿Puedo llevar mi celular?": "SÃ­, pero recomendamos asegurar bien tus pertenencias para evitar caÃ­das.",
    "Â¿Hay baÃ±os o zona de espera?": "SÃ­, la pista cuenta con zona de descanso y baÃ±o disponible.",
    "Â¿Puedo volar si tengo una condiciÃ³n mÃ©dica?": "Depende del caso. Si es algo leve, no hay problema, pero recomendamos avisarlo antes del vuelo.",
    "Â¿Puedo llevar mascotas?": "No durante el vuelo, pero pueden quedarse acompaÃ±adas en tierra.",
    "Â¿QuÃ© pasa si llego tarde?": "El vuelo puede reprogramarse segÃºn disponibilidad, pero te recomendamos puntualidad.",
    "Â¿Puedo cambiar mi reserva?": "SÃ­, puedes hacerlo con mÃ­nimo 12 horas de anticipaciÃ³n."
  }
};


// ğŸ—£ï¸ Respuestas rÃ¡pidas
const respuestasSaludo = [
  "Â¡Hola! ğŸ˜Š Â¿CÃ³mo estÃ¡s?",
  "Â¡Hola! ğŸ‘‹ Bienvenido a FLY.N.C.",
  "Â¡Hola! ğŸª‚ Â¿Listo para una experiencia en el cielo?"
];

const respuestasDespedida = [
  "Â¡Hasta pronto! ğŸ‘‹ Gracias por interesarte en FLY.N.C. Â¡Te esperamos para volar!",
  "Â¡Nos vemos en el cielo! ğŸª‚",
  "Â¡AdiÃ³s! ğŸŒ¤ï¸ Que tengas un gran dÃ­a lleno de aventura."
];

// ğŸ§¹ Procesamiento de texto
function limpiarTexto(texto) {
  return texto
    .toLowerCase()
    .replace(/[^\w\sÂ¿?Ã¡Ã©Ã­Ã³ÃºÃ±]/g, " ")
    .replace(/\s+/g, " ")
    .trim();
}

// ğŸ¯ Detectar saludo o despedida
function detectarSaludo(pregunta) {
  const saludos = ["hola", "buenos dÃ­as", "buenas tardes", "buenas noches", "saludos", "quÃ© tal", "hey"];
  return saludos.some(s => limpiarTexto(pregunta).includes(s));
}

function detectarDespedida(pregunta) {
  const despedidas = ["adiÃ³s", "hasta luego", "nos vemos", "chau", "bye", "salir", "terminar"];
  return despedidas.some(d => limpiarTexto(pregunta).includes(d));
}

// ğŸ” Calcular similitud bÃ¡sica (por palabras coincidentes)
function calcularSimilitud(p1, p2) {
  const palabras1 = new Set(limpiarTexto(p1).split(" "));
  const palabras2 = new Set(limpiarTexto(p2).split(" "));
  const interseccion = [...palabras1].filter(p => palabras2.has(p)).length;
  const union = Math.max(palabras1.size, palabras2.size);
  return interseccion / union;
}

// ğŸ’¬ Buscar mejor respuesta
function encontrarMejorRespuesta(preguntaUsuario) {
  if (detectarSaludo(preguntaUsuario)) {
    return respuestasSaludo[Math.floor(Math.random() * respuestasSaludo.length)];
  }
  if (detectarDespedida(preguntaUsuario)) {
    return respuestasDespedida[Math.floor(Math.random() * respuestasDespedida.length)];
  }

  let mejorRespuesta = "";
  let mejorPuntuacion = 0;

  for (const categoria in baseConocimiento) {
    const preguntas = baseConocimiento[categoria];
    for (const preguntaBase in preguntas) {
      const puntuacion = calcularSimilitud(preguntaUsuario, preguntaBase);
      if (puntuacion > mejorPuntuacion) {
        mejorPuntuacion = puntuacion;
        mejorRespuesta = preguntas[preguntaBase];
      }
    }
  }

  if (mejorPuntuacion > 0.2) {
    return "ğŸª‚ " + mejorRespuesta;
  } else {
    const alternativas = [
      "ğŸ¤” No estoy seguro, Â¿podrÃ­as reformular tu pregunta sobre FLY.N.C?",
      "ğŸ” Puedo ayudarte con reservas, precios, ubicaciÃ³n o seguridad del vuelo.",
      "â“ Hmm, no tengo esa informaciÃ³n por ahora."
    ];
    return alternativas[Math.floor(Math.random() * alternativas.length)];
  }
}

// ğŸ§© Interfaz con HTML
const chatbotBody = document.getElementById("chatbot-body");
const userInput = document.getElementById("user-input");
const sendBtn = document.getElementById("send-btn");
const closeChat = document.getElementById("close-chat");
const chatbotContainer = document.getElementById("chatbot");

// Mostrar y ocultar chatbot
const chatbotBtn = document.querySelector(".chatbot-btn");
if (chatbotBtn) {
  chatbotBtn.addEventListener("click", () => {
    chatbotContainer.style.display = "flex";
  });
}

if (closeChat) {
  closeChat.addEventListener("click", () => {
    chatbotContainer.style.display = "none";
  });
}

// Enviar mensaje
function agregarMensaje(mensaje, tipo) {
  const div = document.createElement("div");
  div.classList.add(tipo === "bot" ? "bot-message" : "user-message");
  div.textContent = mensaje;
  chatbotBody.appendChild(div);
  chatbotBody.scrollTop = chatbotBody.scrollHeight;
}

function enviarMensaje() {
  const texto = userInput.value.trim();
  if (!texto) return;
  agregarMensaje(texto, "user");
  userInput.value = "";

  setTimeout(() => {
    const respuesta = encontrarMejorRespuesta(texto);
    agregarMensaje(respuesta, "bot");
  }, 400);
}

sendBtn.addEventListener("click", enviarMensaje);
userInput.addEventListener("keypress", (e) => {
  if (e.key === "Enter") enviarMensaje();
});
